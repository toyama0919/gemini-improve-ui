(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const t of document.querySelectorAll('link[rel="modulepreload"]'))o(t);new MutationObserver(t=>{for(const r of t)if(r.type==="childList")for(const d of r.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&o(d)}).observe(document,{childList:!0,subtree:!0});function s(t){const r={};return t.integrity&&(r.integrity=t.integrity),t.referrerPolicy&&(r.referrerPolicy=t.referrerPolicy),t.crossOrigin==="use-credentials"?r.credentials="include":t.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(t){if(t.ep)return;t.ep=!0;const r=s(t);fetch(t.href,r)}})();try{}catch(e){console.error("[wxt] Failed to initialize plugins",e)}const h={chat:{navigateToSearch:"Insert",toggleSidebar:"Delete",toggleHistoryMode:"End",scrollUp:"PageUp",scrollDown:"PageDown",historyUp:"ArrowUp",historyDown:"ArrowDown",historyOpen:"Enter",historyExit:"Escape"},search:{moveUp:"ArrowUp",moveDown:"ArrowDown",openResult:"Enter",scrollUp:"PageUp",scrollDown:"PageDown"}},m=[{id:"default",prompt:"これについて詳しく"}];let c=JSON.parse(JSON.stringify(h)),a=900,i=JSON.parse(JSON.stringify(m));function y(){chrome.storage.sync.get(["shortcuts","chatWidth","deepDiveModes","currentDeepDiveModeId"],e=>{e.shortcuts&&(c=e.shortcuts),e.chatWidth&&(a=e.chatWidth),e.deepDiveModes&&e.deepDiveModes.length>0&&(i=e.deepDiveModes),f()})}function u(){const e=document.getElementById("deepDiveModes");if(!e)return;e.innerHTML="",i.forEach((s,o)=>{const t=document.createElement("div");t.style.cssText="border: 1px solid #e0e0e0; border-radius: 4px; padding: 12px; margin-bottom: 8px; background: #fafafa; display: grid; grid-template-columns: 120px 1fr auto; gap: 12px; align-items: center;";const r=document.createElement("input");r.type="text",r.dataset.modeIndex=String(o),r.value=s.id||"",r.placeholder="ID",r.style.cssText="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px;";const d=document.createElement("input");d.type="text",d.dataset.modeIndex=String(o),d.value=s.prompt||"",d.placeholder="プロンプト",d.style.cssText="padding: 6px 12px; border: 1px solid #ddd; border-radius: 4px;";const l=document.createElement("button");l.className="btn-secondary btn-delete-mode",l.dataset.modeIndex=String(o),l.textContent="削除",l.style.cssText="padding: 6px 12px;",t.appendChild(r),t.appendChild(d),t.appendChild(l),e.appendChild(t),r.addEventListener("input",p=>{i[o].id=p.target.value}),d.addEventListener("input",p=>{i[o].prompt=p.target.value}),l.addEventListener("click",()=>{i.length>1?(i.splice(o,1),u()):alert("少なくとも1つのモードが必要です")})});const n=document.createElement("button");n.className="btn-primary",n.textContent="+ モードを追加",n.style.cssText="width: 100%; margin-top: 8px;",n.addEventListener("click",()=>{i.push({id:"mode-"+Date.now(),prompt:""}),u()}),e.appendChild(n)}function f(){u();const e=document.getElementById("chatWidth"),n=document.getElementById("chatWidthValue");e&&n&&(e.value=String(a),n.textContent=`${a}px`);for(const s in c.chat){const o=document.getElementById(`chat.${s}`);o&&(o.value=c.chat[s])}for(const s in c.search){const o=document.getElementById(`search.${s}`);o&&(o.value=c.search[s])}}function v(){i.forEach((e,n)=>{e.id||(e.id=`mode-${n}-${Date.now()}`)}),chrome.storage.sync.set({shortcuts:c,chatWidth:a,deepDiveModes:i},()=>{g("Settings saved successfully!")})}function E(){c=JSON.parse(JSON.stringify(h)),a=900,i=JSON.parse(JSON.stringify(m)),f(),chrome.storage.sync.set({shortcuts:c,chatWidth:a,deepDiveModes:i,currentDeepDiveModeId:"default"},()=>{g("Settings reset to default!")})}function g(e){const n=document.getElementById("message");n&&(n.textContent=e,n.classList.add("show"),setTimeout(()=>n.classList.remove("show"),2e3))}function D(e,n){if(e.preventDefault(),["Control","Alt","Shift","Meta"].includes(e.key))return;const[s,o]=n.split(".");c[s][o]=e.code,e.target.value=e.code}document.addEventListener("DOMContentLoaded",()=>{y();const e=document.getElementById("chatWidth"),n=document.getElementById("chatWidthValue");e&&n&&e.addEventListener("input",o=>{a=parseInt(o.target.value),n.textContent=`${a}px`}),document.querySelectorAll('input[type="text"]').forEach(o=>{o.addEventListener("keydown",t=>{D(t,o.id)}),o.addEventListener("keypress",t=>{t.preventDefault()})}),document.getElementById("saveBtn")?.addEventListener("click",()=>{v()}),document.getElementById("resetBtn")?.addEventListener("click",()=>{confirm("Reset all settings to default values?")&&E()})});
